; CodeVisionAVR C Compiler
; (C) 1998-2004 Pavel Haiduc, HP InfoTech s.r.l.
;
; Updated, Mark Atherton, EDAC Electronics, 14th Sept 2005
;
; FROM EXAMPLE STARTUP FILE FOR CodeVisionAVR V1.24.1 OR LATER
;
; LOW CLEAR 0x100..0x1FF
;
	.EQU __LCLEAR_START=0x100 			; START ADDRESS OF SRAM AREA TO CLEAR
	.EQU __LCLEAR_SIZE=0x100 	   		; SIZE OF SRAM AREA TO CLEAR IN BYTES
;
; HI CLEAR 0x210..0x10FF
;
; SET ** __HCLEAR_START ** TO FIRST STATIC STORAGE TO BE CLEARED
;
	.EQU __HCLEAR_START=0x210 			; START ADDRESS OF SRAM AREA TO CLEAR
	.EQU __HCLEAR_SIZE=(0x10FF-__HCLEAR_START)    	; SIZE OF SRAM AREA TO CLEAR IN BYTES

	CLI		;DISABLE INTERRUPTS
	CLR  R30
	OUT  EECR,R30	;DISABLE EEPROM ACCESS
;
;DISABLE THE WATCHDOG
;
	LDI  R31,0x18
	OUT  WDTCR,R31
	OUT  WDTCR,R30
;
	OUT  MCUCR,R30	;MCUCR=0, NO EXTERNAL SRAM ACCESS
;
;CLEAR R2-R14
	LDI  R24,13
	LDI  R26,2
	CLR  R27
__CLEAR_REG:
	ST   X+,R30
	DEC  R24
	BRNE __CLEAR_REG
;
; CLEAR LOW SRAM
;
	LDI  R24,LOW(__LCLEAR_SIZE)
	LDI  R25,HIGH(__LCLEAR_SIZE)
	LDI  R26,LOW(__LCLEAR_START)
	LDI  R27,HIGH(__LCLEAR_START)
;
__LCLEAR_SRAM:
	ST   X+,R30
	SBIW R24,1
	BRNE __LCLEAR_SRAM
;
; CLEAR HIGH SRAM
;
	LDI  R24,LOW(__HCLEAR_SIZE)
	LDI  R25,HIGH(__HCLEAR_SIZE)
	LDI  R26,LOW(__HCLEAR_START)
	LDI  R27,HIGH(__HCLEAR_START)
;
__HCLEAR_SRAM:
	ST   X+,R30
	SBIW R24,1
	BRNE __HCLEAR_SRAM
;
; GLOBAL VARIABLES INITIALIZATION
;
	LDI  R30,LOW(__GLOBAL_INI_TBL*2)
	LDI  R31,HIGH(__GLOBAL_INI_TBL*2)
__GLOBAL_INI_NEXT:
	LPM
	ADIW R30,1
	MOV  R24,R0
	LPM
	ADIW R30,1
	MOV  R25,R0
	SBIW R24,0
	BREQ __GLOBAL_INI_END
	LPM
	ADIW R30,1
	MOV  R26,R0
	LPM
	ADIW R30,1
	MOV  R27,R0
	LPM
	ADIW R30,1
	MOV  R1,R0
	LPM
	ADIW R30,1
	MOV  R22,R30
	MOV  R23,R31
	MOV  R31,R0
	MOV  R30,R1
__GLOBAL_INI_LOOP:
	LPM
	ADIW R30,1
	ST   X+,R0
	SBIW R24,1
	BRNE __GLOBAL_INI_LOOP
	MOV  R30,R22
	MOV  R31,R23
	RJMP __GLOBAL_INI_NEXT
__GLOBAL_INI_END:
